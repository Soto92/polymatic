(this.webpackJsonpPolymatic=this.webpackJsonpPolymatic||[]).push([[0],{34:function(e,t,a){e.exports=a.p+"static/media/agogo1.b8f6e210.wav"},35:function(e,t,a){e.exports=a.p+"static/media/agogo2.5844966c.wav"},36:function(e,t,a){e.exports=a.p+"static/media/bass.b2419d4f.wav"},37:function(e,t,a){e.exports=a.p+"static/media/block.3753c44b.wav"},38:function(e,t,a){e.exports=a.p+"static/media/bum.4c11d5fa.wav"},39:function(e,t,a){e.exports=a.p+"static/media/claves.400c9ef3.wav"},40:function(e,t,a){e.exports=a.p+"static/media/conga1.41b2f57f.wav"},41:function(e,t,a){e.exports=a.p+"static/media/conga2.887c0c16.wav"},42:function(e,t,a){e.exports=a.p+"static/media/cymbal.950d832b.wav"},43:function(e,t,a){e.exports=a.p+"static/media/djembe1.f3e648cb.wav"},44:function(e,t,a){e.exports=a.p+"static/media/djembe3.acef368f.wav"},45:function(e,t,a){e.exports=a.p+"static/media/djembe2.d38ab3d2.wav"},46:function(e,t,a){e.exports=a.p+"static/media/hit.a315148b.wav"},47:function(e,t,a){e.exports=a.p+"static/media/hithat.950d832b.wav"},48:function(e,t,a){e.exports=a.p+"static/media/kick1.e63d68a9.wav"},49:function(e,t,a){e.exports=a.p+"static/media/kick2.18445a5e.wav"},50:function(e,t,a){e.exports=a.p+"static/media/kicklow.c09eab14.wav"},51:function(e,t,a){e.exports=a.p+"static/media/snare.96dbe59f.wav"},52:function(e,t,a){e.exports=a.p+"static/media/tamborim.a6cbfb58.wav"},55:function(e){e.exports=JSON.parse('{"name":"Polymatic","version":"3.1.3","private":true,"homepage":"https://polymatic.ciberterreiro.org","dependencies":{"@fortawesome/fontawesome-svg-core":"^1.2.27","@fortawesome/free-solid-svg-icons":"^5.12.1","@fortawesome/react-fontawesome":"^0.1.9","@testing-library/jest-dom":"^4.2.4","@testing-library/react":"^9.3.2","@testing-library/user-event":"^7.1.2","beet.js":"^1.7.0","bootstrap":"^4.4.1","euclidean-rhythms":"^2.0.1","gh-pages":"^2.2.0","melanke-watchjs":"^1.5.2","react":"^16.13.0","react-bootstrap":"^1.0.0-beta.17","react-bootstrap-range-slider":"^0.3.1","react-dom":"^16.13.0","react-ga":"^2.7.0","react-scripts":"3.4.0","shortid":"^2.2.15","watchjs":"^0.0.0","webworkify-webpack":"^2.1.5"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject","predeploy":"npm run build && cp CNAME build/CNAME","deploy":"gh-pages -b gh-pages -d build"},"eslintConfig":{"extends":"react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]}}')},67:function(e,t,a){e.exports=a(93)},72:function(e,t,a){},83:function(e,t,a){"use strict";a.r(t),t.default=function(e){var t=25,a=null;e.onmessage=function(e){"interval"===e.data&&(t=e.data.interval),"start"===e.data&&(a=setInterval((function(){postMessage("tick")}),t)),"stop"===e.data&&(clearInterval(a),a=null)}}},92:function(e,t,a){},93:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(23),s=a.n(r),o=(a(72),a(66)),c=a(7),l=a(30),u=a(24),h=a.n(u),m=a(12),p=a(13),f=a(8),d=a.n(f),v=a(32),b=a.n(v).a.watch;function y(e,t){var a=this;return a._createSequence(e,t),b(this,["pulses","steps"],(function(){a.update(this.pulses,this.steps)})),this}y.prototype.update=function(e,t){return this._createSequence(e,t),this},y.prototype.shift=function(e){var t=e>this.seq.length?e-=this.seq.length:e;if(t===this.seq.length)return this;for(var a=this.seq.splice(this.seq.length-t,t),n=0;n<a.length;n++)this.seq.unshift(a[n]);return this},y.prototype._createSequence=function(e,t){var a=typeof e;return"number"===a?(this.pulses=e,this.steps=t||e,this.seq=h.a.getPattern(this.pulses,this.steps)):"string"===a&&(this.steps=e.length,this.seq=e.split("")),this};var g=y,w=a(33),k=a.n(w);function x(e,t){var a=this;if(!e)throw new Error("Context is mandatory");if(!t)throw new Error("Callback is mandatory");this.context=e,this.steps=16,this.tempo=120,this.callback=t,this.look_ahead=1,this._step=1,this._scheduler_interval=20,this._next_event_time=0,this._first=!0,this._is_running=!1,this._worker=k()(83),this._worker.onmessage=function(e){"tick"===e.data&&a._is_running&&a._scheduler()},this._worker.postMessage({interval:a._scheduler_interval})}x.prototype.start=function(e){this._is_running?console.log("already started"):(this._is_running=!0,this._worker.postMessage("start"))},x.prototype.pause=function(){this._is_running=!1,this._worker.postMessage("stop")},x.prototype.stop=function(){this._first=!0,this._step=1,this._is_running=!1,this._worker.postMessage("stop")},x.prototype._scheduler=function(){for(1===this._step&&this._first&&(this._next_event_time=this.context.currentTime);this._next_event_time<this.context.currentTime+this.look_ahead;){var e=this._next_event_time-this.context.currentTime;this.callback(this._next_event_time,this._step,e),this._next()}},x.prototype._next=function(){this._step++,this._first&&(this._next_event_time=this.context.currentTime,this._first=!1),this._step>this.steps&&(this._step=1),this._next_event_time+=60/this.tempo*4/this.steps};var _=x,E=function(){function e(t,a,n,i,r,s,o){var c=this;Object(m.a)(this,e),o||(o=function(){}),this.id=t,this.on=s,this.off=o,this.tempo=n,this.clavis=i,this.context=a,this.sequence=r,this.metro=new _(a,(function(e,t,a){c.metro.steps!==c.sequence.seq.length&&(c.metro.steps=c.sequence.seq.length),"1"===r.seq[t-1]?(c.on(e,t,a),setTimeout((function(){i.setCurrentStep(t)}),1e3)):(c.off(e,t,a),setTimeout((function(){i.setCurrentStep(t)}),1e3))})),this.metro.steps=r.seq.length,this.metro.tempo=this.tempo}return Object(p.a)(e,[{key:"start",value:function(){this.metro.start()}},{key:"pause",value:function(){this.metro.pause()}},{key:"stop",value:function(){this.metro.stop()}},{key:"watch",value:function(e){this.metro.tempo=e}}]),e}(),j=function(){function e(t){var a=t.context;Object(m.a)(this,e),this.context=a,this.tempo=120,this.layers=[]}return Object(p.a)(e,[{key:"layer",value:function(e,t,a,n,i){return new E(d.a.generate(),this.context,t,a,e,n,i)}},{key:"pattern",value:function(e,t){return new g(e,t)}},{key:"add",value:function(e){this.layers.push(e)}},{key:"remove",value:function(e){e.metro.stop(),this.layers=this.layers.filter((function(t){return t.id!==e.id}))}},{key:"start",value:function(){this.layers.forEach((function(e){e.start()}))}},{key:"pause",value:function(){this.layers.forEach((function(e){e.pause()}))}},{key:"load",value:function(e,t,a,n){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){e.decodeAudioData(i.response,a,n)},i.onerror=n,i.send()}},{key:"envelope",value:function(e,t,a){a||(a={});var n=a.peak||e.defaultValue;0===a.start&&(a.start=1e-6);var i=a.start||e.value,r=a.attack||.1,s=a.decay||0,o=a.sustain||n,c=a.release||.5;e.setValueAtTime(i,t),e.linearRampToValueAtTime(n,t+r),e.linearRampToValueAtTime(o,t+r+s),e.linearRampToValueAtTime(0,t+r+s+c)}},{key:"changeTempo",value:function(e){var t=!0,a=!1,n=void 0;try{for(var i,r=this.layers[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){i.value.metro.tempo=e}}catch(s){a=!0,n=s}finally{try{t||null==r.return||r.return()}finally{if(a)throw n}}}}]),e}(),O=function(){function e(){Object(m.a)(this,e),this.canvas=null,this.context=null,this.pattern=null,this.tempo=0,this.animate=!1,this.lastRender=Date.now(),this.draw=this.draw.bind(this),this.currentStep=1,this.patternPos={}}return Object(p.a)(e,[{key:"configure",value:function(e,t,a){this.canvas=e,this.context=e.getContext("2d"),this.pattern=t,this.tempo=a}},{key:"setCurrentStep",value:function(e){this.currentStep=e}},{key:"play",value:function(){this.animate=!0,window.requestAnimationFrame(this.draw)}},{key:"pause",value:function(){this.animate=!1}},{key:"draw",value:function(){var e=this.canvas,t=this.context,a=this.pattern,n="20px",i=2,r="#ccc",s="#000",o=4,l="#000",u="#000",h=2,m="#ccc",p="#ccc",f=5,d="#fc0",v="#fc0",b=[200,200],y=b[0],g=b[1],w=80,k=2*Math.PI/a.length,x=-.5*Math.PI;function _(e,a,n){var i=n.radius,r=n.stroke,s=n.fill;t.strokeStyle=r,t.fillStyle=s,t.beginPath(),t.arc(e,a,i,0,2*Math.PI),t.fill(),t.stroke()}function E(e,t){_(e,t,{radius:o,stroke:l,fill:u})}function j(e,t){_(e,t,{radius:h,stroke:m,fill:p})}e.style.padding=n,e.width=y,e.height=g,t.clearRect(0,0,y,g),t.lineWidth=i,t.strokeStyle=r,t.beginPath(),t.arc(y/2,g/2,w,0,2*Math.PI),t.stroke();var O=[];function q(e,t){return[Math.cos(e)*t+y/2,Math.sin(e)*t+g/2]}for(var S=0;S<a.length;S++){var P=q(x+k*S,w),C=Object(c.a)(P,2),T=C[0],N=C[1];"1"===a[S]?(E(T,N),O.push([T,N])):j(T,N),this.patternPos[S]={x:T,y:N}}O.length>=1&&function(e){t.strokeStyle=s,t.beginPath(),t.moveTo(e[0][0],e[0][1]);for(var a=1;a<e.length;a++)t.lineTo(e[a][0],e[a][1]);t.closePath(),t.stroke()}(O),function(e,t){_(e,t,{radius:f,stroke:d,fill:v})}(this.patternPos[this.currentStep-1].x,this.patternPos[this.currentStep-1].y),this.animate&&window.requestAnimationFrame(this.draw)}}]),e}(),q=function(){function e(){var t=this;Object(m.a)(this,e),this.callbackOn=function(e,a){var n=t.context.createGain();n.gain.value=t.volume,n.connect(t.context.destination);var i=t.context.createBufferSource();t.beet.load(t.beet.context,t.instrument,(function(t){i.buffer=t,i.connect(n),i.start(e)}))},this.volume=1,this.context=null,this.beet=null,this.instrument=null}return Object(p.a)(e,[{key:"configure",value:function(e,t,a){this.context=e,this.beet=t,this.instrument=a}},{key:"setVolume",value:function(e){this.volume=e}},{key:"getVolume",value:function(){return this.volume}}]),e}(),S=a(34),P=a.n(S),C=a(35),T=a.n(C),N=a(36),A=a.n(N),M=a(37),R=a.n(M),I=a(38),V=a.n(I),B=a(39),L=a.n(B),J=a(40),U=a.n(J),W=a(41),$=a.n(W),z=a(42),D=a.n(z),F=a(43),G=a.n(F),H=a(44),X=a.n(H),K=a(45),Q=a.n(K),Y=a(46),Z=a.n(Y),ee=a(47),te=a.n(ee),ae=a(48),ne=a.n(ae),ie=a(49),re=a.n(ie),se=a(50),oe=a.n(se),ce=a(51),le=a.n(ce),ue=a(52),he=a.n(ue),me={agogo1:P.a,agogo2:T.a,bass:A.a,block:R.a,bum:V.a,claves:L.a,conga1:U.a,conga2:$.a,cymbal:D.a,djembe1:G.a,djembe2:X.a,djembe3:Q.a,hit:Z.a,hithat:te.a,kick1:ne.a,kick2:re.a,kicklow:oe.a,snare:le.a,tamborim:he.a},pe=a(53),fe=a.n(pe),de=(a(84),a(14)),ve=a(15);function be(e){var t=e.guia,a=e.removeLayer,r=Object(n.useRef)(),s=Object(n.useState)(100),o=Object(c.a)(s,2),l=o[0],u=o[1],h=t.sequence,m=t.tempo,p=t.layer,f=t.clavis,v=t.channel;Object(n.useEffect)((function(){f.configure(r.current,h,m),f.play()}));return i.a.createElement("div",{className:"layer"},i.a.createElement("canvas",{id:d.a.generate(),ref:r,width:640,height:425}),i.a.createElement("ul",null,i.a.createElement("li",null,"sequence: ",h),i.a.createElement("li",null,"tempo: ",m)),a&&i.a.createElement("div",{className:"controls"},i.a.createElement("button",{onClick:function(){return p.start(),void f.play()}},i.a.createElement(de.a,{icon:ve.a})),i.a.createElement("button",{onClick:function(){return p.stop(),void f.pause()}},i.a.createElement(de.a,{icon:ve.b})),i.a.createElement("button",{onClick:function(){return a(t)}},i.a.createElement(de.a,{icon:ve.c}))),i.a.createElement("div",{className:"mt-2"},i.a.createElement(fe.a,{value:l,min:0,max:100,tooltipLabel:function(e){return"".concat(e,"%")},onChange:function(e){return function(e){var t=function(e,t,a,n,i){return n+(i-n)*(e-t)/(a-t)}(e,0,100,0,1);u(e),v.setVolume(t)}(Number(e.target.value))}})))}function ye(e){e.preview;var t=e.sequence,a=e.clavis,r=Object(n.useRef)();return Object(n.useEffect)((function(){a.configure(r.current,t,120),a.draw()})),i.a.createElement("div",{className:"layer"},i.a.createElement("canvas",{id:d.a.generate(),ref:r,width:640,height:425}),i.a.createElement("p",{className:"Preview"},"Pr\xe9-visualiza\xe7\xe3o"))}var ge,we=a(55),ke=a(29),xe=(ge={},Object(ke.a)(ge,d.a.generate(),{name:"Rumba",instruments:[{sequence:"1001000100101000",tempo:120,sample:"conga1"}]}),Object(ke.a)(ge,d.a.generate(),{name:"Centro de gravidade",instruments:[{sequence:"10101",tempo:120,sample:"bum"},{sequence:"10110101",tempo:120,sample:"bass"}]}),ge),_e=a(95),Ee=a(56),je=a(96),Oe=a(57),qe=a(98),Se=a(97);var Pe=function(e){var t=e.layers,a=(e.beet,e.pattern),r=e.setPattern,s=e.patternError,o=e.sequence,l=(e.setPreview,e.handleStoreUpdate),u=Object(n.useState)("agogo1"),h=Object(c.a)(u,2),m=h[0],p=h[1],f=Object(n.useState)(120),v=Object(c.a)(f,2),b=v[0],y=v[1];return i.a.createElement("div",{className:"header"},i.a.createElement("div",null,i.a.createElement("h1",{className:"header-logo"},"Polymatic ",i.a.createElement("small",null,we.version))),i.a.createElement("div",{className:"header-controls"},i.a.createElement(_e.a,{"aria-label":"Basic example"},i.a.createElement(Ee.a,{variant:"secondary",onClick:function(){return function(){var e=!0,a=!1,n=void 0;try{for(var i,r=t[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var s=i.value;s.layer.start(),s.clavis.play()}}catch(o){a=!0,n=o}finally{try{e||null==r.return||r.return()}finally{if(a)throw n}}}()}},i.a.createElement(de.a,{icon:ve.a})),i.a.createElement(Ee.a,{variant:"secondary",onClick:function(){return function(){var e=!0,a=!1,n=void 0;try{for(var i,r=t[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var s=i.value;s.layer.stop(),s.clavis.pause()}}catch(o){a=!0,n=o}finally{try{e||null==r.return||r.return()}finally{if(a)throw n}}}()}},i.a.createElement(de.a,{icon:ve.b})))),i.a.createElement("div",{className:"header-form"},i.a.createElement(je.a,null,i.a.createElement(je.a.Prepend,null,i.a.createElement(je.a.Text,{id:"basic-addon3"},"Padr\xe3o")),i.a.createElement(Oe.a,{placeholder:"1010101 ou 3,4",value:a,onChange:function(e){return r(e.target.value)},isInvalid:a.length>0&&s})),i.a.createElement(je.a,null,i.a.createElement(je.a.Prepend,null,i.a.createElement(je.a.Text,{id:"basic-addon3"},"Tempo")),i.a.createElement(Oe.a,{placeholder:"tempo",value:b,onChange:function(e){return y(e.target.value)}})),i.a.createElement(qe.a.Control,{as:"select",onChange:function(e){return p(e.target.value)}},Object.keys(me).map((function(e,t){return i.a.createElement("option",{key:t,value:e},e)}))),i.a.createElement(Ee.a,{className:"ml-2",onClick:function(){return function(){var e={name:d.a.generate(),instruments:[{sequence:o,tempo:b,sample:m}]};l(e)}()},disabled:s},"Adicionar"),i.a.createElement(Se.a,{className:"ml-2"},i.a.createElement(Se.a.Toggle,{variant:"info",id:"dropdown-basic"},"presets"),i.a.createElement(Se.a.Menu,null,Object.keys(xe).map((function(e,t){return i.a.createElement(Se.a.Item,{key:t,onClick:function(){l(xe[e])}},xe[e].name)}))))))};a(91),a(92);var Ce=function(){var e=Object(n.useState)([]),t=Object(c.a)(e,2),a=t[0],r=t[1],s=Object(n.useState)(!0),u=Object(c.a)(s,2),m=u[0],p=u[1],f=Object(n.useState)(""),v=Object(c.a)(f,2),b=v[0],y=v[1],g=Object(n.useState)(!1),w=Object(c.a)(g,2),k=w[0],x=w[1],_=Object(n.useState)(""),E=Object(c.a)(_,2),S=E[0],P=E[1],C=Object(n.useState)([]),T=Object(c.a)(C,2),N=T[0],A=T[1];l.a.initialize("UA-160360260-2"),l.a.pageview(window.location.pathname+window.location.search),window.AudioContext=window.AudioContext||window.webkitAudioContext;var M=new AudioContext,R=new j({context:M});Object(n.useEffect)((function(){!function(e){var t=new RegExp("^(\\d+(\\.\\d+)?),(\\d+(\\.\\d+)?)$"),a=new RegExp("^[0-1]{1,}$");if(t.test(b)){var n=e.split(",").map((function(e){return parseInt(e)})).sort((function(e,t){return e-t})),i=Object(c.a)(n,2),r=i[0],s=i[1],o=h.a.getPattern(r,s).join("");P(o),p(!0),x(!1)}else a.test(b)?(P(b),p(!0),x(!1)):(""===e&&P(""),p(!1),x(!0))}(b)}),[S,b]);var I=function(e,t,a,n,i){r((function(r){return r.concat({id:d.a.generate(),sequence:e,tempo:t,layer:a,clavis:n,channel:i})}))},V=function(e){R.remove(e.layer),e.clavis.pause(),r(a.filter((function(t){return t.id!==e.id})))},B={layers:a,beet:R,pattern:b,setPattern:y,patternError:k,sequence:S,setPreview:p,handleStoreUpdate:function(e){e.instruments.map((function(e){var t=e.sequence,a=e.tempo,n=e.sample;A([].concat(Object(o.a)(N),[{sequence:t,tempo:a,sample:n}])),function(e,t,a){p(!1);var n=R.pattern(e),i=new O,r=new q;r.configure(M,R,me[a]);var s={layer:R.layer(n,t,i,r.callbackOn)};s.layer.tempo=t,R.add(s.layer),I(e,t,s.layer,i,r)}(t,a,n)})),R.start()}};return i.a.createElement("div",{className:"App"},i.a.createElement(Pe,B),i.a.createElement("div",{className:"wrapper"},a.map((function(e){return i.a.createElement(be,{key:e.id,guia:e,removeLayer:V})})),m&&S.length>0&&i.a.createElement(ye,{sequence:S,clavis:new O})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(i.a.createElement(Ce,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[67,1,2]]]);
//# sourceMappingURL=main.ddc71ed7.chunk.js.map