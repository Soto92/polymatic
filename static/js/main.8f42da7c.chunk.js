(this.webpackJsonpPolymatic=this.webpackJsonpPolymatic||[]).push([[0],{111:function(e,t,n){},112:function(e,t,n){},113:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(23),s=n.n(i),o=(n(87),n(7)),c=n(38),l=n(18),u=n(44),m=n(81),h=n(32),f=n.n(h),p=n(14),d=n(15),v=n(8),b=n.n(v),g=n(47),y=n.n(g).a.watch;function w(e,t){var n=this;return n._createSequence(e,t),y(this,["pulses","steps"],(function(){n.update(this.pulses,this.steps)})),this}w.prototype.update=function(e,t){return this._createSequence(e,t),this},w.prototype.shift=function(e){var t=e>this.seq.length?e-=this.seq.length:e;if(t===this.seq.length)return this;for(var n=this.seq.splice(this.seq.length-t,t),a=0;a<n.length;a++)this.seq.unshift(n[a]);return this},w.prototype._createSequence=function(e,t){var n=typeof e;return"number"===n?(this.pulses=e,this.steps=t||e,this.seq=f.a.getPattern(this.pulses,this.steps)):"string"===n&&(this.steps=e.length,this.seq=e.split("")),this};var k=w,E=n(48),x=n.n(E);function _(e,t){var n=this;if(!e)throw new Error("Context is mandatory");if(!t)throw new Error("Callback is mandatory");this.context=e,this.steps=16,this.tempo=120,this.callback=t,this.look_ahead=1,this._step=1,this._scheduler_interval=20,this._next_event_time=0,this._first=!0,this._is_running=!1,this._worker=x()(98),this._worker.onmessage=function(e){"tick"===e.data&&n._is_running&&n._scheduler()},this._worker.postMessage({interval:n._scheduler_interval})}_.prototype.start=function(e){this._is_running?console.log("already started"):(this._is_running=!0,this._worker.postMessage("start"))},_.prototype.pause=function(){this._is_running=!1,this._worker.postMessage("stop")},_.prototype.stop=function(){this._first=!0,this._step=1,this._is_running=!1,this._worker.postMessage("stop")},_.prototype._scheduler=function(){for(1===this._step&&this._first&&(this._next_event_time=this.context.currentTime);this._next_event_time<this.context.currentTime+this.look_ahead;){var e=this._next_event_time-this.context.currentTime;this.callback(this._next_event_time,this._step,e),this._next()}},_.prototype._next=function(){this._step++,this._first&&(this._next_event_time=this.context.currentTime,this._first=!1),this._step>this.steps&&(this._step=1),this._next_event_time+=60/this.tempo*4/this.steps};var j=_,O=function(){function e(t,n,a,r,i,s){var o=this;Object(p.a)(this,e),this.id=t,this.on=s,this.tempo=a,this.clavis=r,this.context=n,this.sequence=i,this.metro=new j(n,(function(e,t,n){o.metro.steps!==o.sequence.seq.length&&(o.metro.steps=o.sequence.seq.length),"1"===i.seq[t-1]?(o.on(e,t,n),setTimeout((function(){r.setCurrentStep(t)}),1e3)):setTimeout((function(){r.setCurrentStep(t)}),1e3)})),this.metro.steps=i.seq.length,this.metro.tempo=this.tempo}return Object(d.a)(e,[{key:"start",value:function(){this.metro.start()}},{key:"pause",value:function(){this.metro.pause()}},{key:"stop",value:function(){this.metro.stop()}},{key:"watch",value:function(e){this.metro.tempo=e}}]),e}(),q=function(){function e(t){var n=t.context;Object(p.a)(this,e),this.context=n,this.tempo=120,this.layers=[]}return Object(d.a)(e,[{key:"layer",value:function(e,t,n,a){return new O(b.a.generate(),this.context,t,n,e,a)}},{key:"pattern",value:function(e,t){return new k(e,t)}},{key:"add",value:function(e){this.layers.push(e)}},{key:"remove",value:function(e){e.metro.stop(),this.layers=this.layers.filter((function(t){return t.id!==e.id}))}},{key:"start",value:function(){this.layers.forEach((function(e){e.start()}))}},{key:"pause",value:function(){this.layers.forEach((function(e){e.pause()}))}},{key:"load",value:function(e,t,n,a){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){e.decodeAudioData(r.response,n,a)},r.onerror=a,r.send()}},{key:"changeTempo",value:function(e){var t=!0,n=!1,a=void 0;try{for(var r,i=this.layers[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){r.value.metro.tempo=e}}catch(s){n=!0,a=s}finally{try{t||null==i.return||i.return()}finally{if(n)throw a}}}}]),e}(),S=function(){function e(){Object(p.a)(this,e),this.canvas=null,this.context=null,this.pattern=null,this.tempo=0,this.animate=!1,this.lastRender=Date.now(),this.draw=this.draw.bind(this),this.currentStep=1,this.patternPos={}}return Object(d.a)(e,[{key:"configure",value:function(e,t,n){this.canvas=e,this.context=e.getContext("2d"),this.pattern=t,this.tempo=n}},{key:"setCurrentStep",value:function(e){this.currentStep=e}},{key:"play",value:function(){this.animate=!0,window.requestAnimationFrame(this.draw)}},{key:"pause",value:function(){this.animate=!1}},{key:"draw",value:function(){var e=this.canvas,t=this.context,n=this.pattern,a="20px",r=2,i="#fff",s="#cc2c11",c=4,l="#cc2c11",u="#cc2c11",m=2,h="#fff",f="#fff",p=8,d="#cc2c11",v="#cc2c11",b=[200,200],g=b[0],y=b[1],w=80,k=2*Math.PI/n.length,E=-.5*Math.PI;function x(e,n,a){var r=a.radius,i=a.stroke,s=a.fill;t.strokeStyle=i,t.fillStyle=s,t.beginPath(),t.arc(e,n,r,0,2*Math.PI),t.fill(),t.stroke()}function _(e,t){x(e,t,{radius:c,stroke:l,fill:u})}function j(e,t){x(e,t,{radius:m,stroke:h,fill:f})}e.style.padding=a,e.width=g,e.height=y,t.clearRect(0,0,g,y),t.lineWidth=r,t.strokeStyle=i,t.beginPath(),t.arc(g/2,y/2,w,0,2*Math.PI),t.stroke();var O=[];function q(e,t){return[Math.cos(e)*t+g/2,Math.sin(e)*t+y/2]}for(var S=0;S<n.length;S++){var C=q(E+k*S,w),P=Object(o.a)(C,2),N=P[0],T=P[1];"1"===n[S]?(_(N,T),O.push([N,T])):j(N,T),this.patternPos[S]={x:N,y:T}}O.length>=1&&function(e){t.strokeStyle=s,t.beginPath(),t.moveTo(e[0][0],e[0][1]);for(var n=1;n<e.length;n++)t.lineTo(e[n][0],e[n][1]);t.closePath(),t.stroke()}(O),function(e,t){x(e,t,{radius:p,stroke:d,fill:v})}(this.patternPos[this.currentStep-1].x,this.patternPos[this.currentStep-1].y),this.animate&&window.requestAnimationFrame(this.draw)}}]),e}(),C=function(){function e(){var t=this;Object(p.a)(this,e),this.callbackOn=function(e,n){var a=t.context.createGain();a.gain.value=t.volume,a.connect(t.context.destination);var r=t.context.createBufferSource();r.buffer=t.instrument,r.connect(a),r.start(e)},this.volume=1,this.context=null,this.beet=null,this.instrument=null}return Object(d.a)(e,[{key:"configure",value:function(e,t,n){this.context=e,this.beet=t,this.instrument=n}},{key:"setVolume",value:function(e){this.volume=e}},{key:"getVolume",value:function(){return this.volume}}]),e}(),P=n(49),N=n.n(P),T=(n(99),n(21)),M=n(22),A=n(115),I=n(51);function R(e){var t=e.guia,n=e.removeLayer,i=Object(a.useRef)(),s=Object(a.useState)(100),c=Object(o.a)(s,2),l=c[0],u=c[1],m=t.sequence,h=t.tempo,f=t.layer,p=t.clavis,d=t.channel,v=t.sample;Object(a.useEffect)((function(){p.configure(i.current,m,h),p.play()}));return r.a.createElement("div",{className:"layer"},r.a.createElement("canvas",{id:b.a.generate(),ref:i,width:640,height:425}),r.a.createElement("ul",null,r.a.createElement("li",null,"sequence: ",m),r.a.createElement("li",null,"tempo: ",h),r.a.createElement("li",null,"instrumento: ",v)),n&&r.a.createElement("div",{className:"controls"},r.a.createElement(A.a,{"aria-label":"Basic example"},r.a.createElement(I.a,{onClick:function(){return f.start(),void p.play()}},r.a.createElement(T.a,{icon:M.a})),r.a.createElement(I.a,{onClick:function(){return f.stop(),void p.pause()}},r.a.createElement(T.a,{icon:M.b})),r.a.createElement(I.a,{onClick:function(){return n(t)}},r.a.createElement(T.a,{icon:M.c})))),r.a.createElement("div",{className:"mt-2 volume"},r.a.createElement("span",{className:"mr-2"},"Vol."),r.a.createElement(N.a,{value:l,min:0,max:100,tooltipLabel:function(e){return"".concat(e,"%")},onChange:function(e){return function(e){var t=function(e,t,n,a,r){return a+(r-a)*(e-t)/(n-t)}(e,0,100,0,1);u(e),d.setVolume(t)}(Number(e.target.value))}})))}function B(e){e.preview;var t=e.sequence,n=e.clavis,i=Object(a.useRef)();return Object(a.useEffect)((function(){n.configure(i.current,t,120),n.draw()})),r.a.createElement("div",{className:"layer"},r.a.createElement("canvas",{id:b.a.generate(),ref:i,width:640,height:425}),r.a.createElement("p",{className:"Preview"},"Pr\xe9-visualiza\xe7\xe3o"))}var L,D=n(52),V=n.n(D),G=n(53),H=n.n(G),J=n(54),U=n.n(J),W=n(55),X=n.n(W),$=n(56),z=n.n($),F=n(57),K=n.n(F),Q=n(58),Y=n.n(Q),Z=n(59),ee=n.n(Z),te=n(60),ne=n.n(te),ae=n(61),re=n.n(ae),ie=n(62),se=n.n(ie),oe=n(63),ce=n.n(oe),le=n(64),ue=n.n(le),me=n(65),he=n.n(me),fe=n(66),pe=n.n(fe),de=n(67),ve=n.n(de),be=n(68),ge=n.n(be),ye=n(69),we=n.n(ye),ke=n(70),Ee=n.n(ke),xe={agogo1:V.a,agogo2:H.a,bass:U.a,block:X.a,bumbo:z.a,claves:K.a,conga1:Y.a,conga2:ee.a,cymbal:ne.a,djembe1:re.a,djembe2:se.a,djembe3:ce.a,hit:ue.a,hithat:he.a,kick1:pe.a,kick2:ve.a,kicklow:ge.a,snare:we.a,tamborim:Ee.a},_e=n(41),je=(L={},Object(_e.a)(L,b.a.generate(),{name:"Rumba",instruments:[{sequence:"1001000100101000",tempo:120,sample:"conga1"}]}),Object(_e.a)(L,b.a.generate(),{name:"Centro de gravidade",instruments:[{sequence:"10101",tempo:120,sample:"bumbo"},{sequence:"10110101",tempo:120,sample:"bass"}]}),L),Oe=n(116),qe=n(71),Se=n(119),Ce=n(117);var Pe=function(e){var t=e.layers,n=(e.beet,e.pattern),i=e.setPattern,s=e.patternError,c=e.sequence,l=(e.setPreview,e.handleStoreUpdate),u=Object(a.useState)("agogo1"),m=Object(o.a)(u,2),h=m[0],f=m[1],p=Object(a.useState)(120),d=Object(o.a)(p,2),v=d[0],g=d[1],y=Object(a.useState)(!1),w=Object(o.a)(y,2),k=w[0],E=w[1];return r.a.createElement("div",{className:"toolbar"},r.a.createElement("div",{className:"toolbar-controls"},r.a.createElement(A.a,{"aria-label":"Basic example"},r.a.createElement(I.a,{variant:"secondary",onClick:function(){return function(){var e=!0,n=!1,a=void 0;try{for(var r,i=t[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var s=r.value;s.layer.start(),s.clavis.play()}}catch(o){n=!0,a=o}finally{try{e||null==i.return||i.return()}finally{if(n)throw a}}}()}},r.a.createElement(T.a,{icon:M.a})),r.a.createElement(I.a,{variant:"secondary",onClick:function(){return function(){var e=!0,n=!1,a=void 0;try{for(var r,i=t[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var s=r.value;s.layer.stop(),s.clavis.pause()}}catch(o){n=!0,a=o}finally{try{e||null==i.return||i.return()}finally{if(n)throw a}}}()}},r.a.createElement(T.a,{icon:M.b})))),r.a.createElement("div",{className:"toolbar-form"},r.a.createElement(Oe.a,null,r.a.createElement(Oe.a.Prepend,null,r.a.createElement(Oe.a.Text,{id:"basic-addon3"},"Padr\xe3o")),r.a.createElement(qe.a,{placeholder:"1010101 ou 3,4",value:n,onChange:function(e){return i(e.target.value)},isInvalid:n.length>0&&s})),r.a.createElement(Oe.a,null,r.a.createElement(Oe.a.Prepend,null,r.a.createElement(Oe.a.Text,{id:"basic-addon3"},"Tempo")),r.a.createElement(qe.a,{placeholder:"tempo",value:v,onChange:function(e){return g(e.target.value)}})),r.a.createElement(Se.a.Control,{as:"select",onChange:function(e){return f(e.target.value)}},r.a.createElement("option",null,"Instrumentos"),Object.keys(xe).map((function(e,t){return r.a.createElement("option",{key:t,value:e},e)}))),r.a.createElement(Se.a.Check,{inline:!0,className:"ml-2 polymetric",type:"checkbox",label:"Polimetria",checked:k,onChange:function(){return E(!k)}}),r.a.createElement(I.a,{className:"ml-2",onClick:function(){return function(){var e={name:b.a.generate(),instruments:[{sequence:c,tempo:v,sample:h,polymetric:k}]};l(e)}()},disabled:s},"Adicionar"),r.a.createElement(Ce.a,{className:"ml-2"},r.a.createElement(Ce.a.Toggle,{variant:"info",id:"dropdown-basic"},"presets"),r.a.createElement(Ce.a.Menu,null,Object.keys(je).map((function(e,t){return r.a.createElement(Ce.a.Item,{key:t,onClick:function(){l(je[e])}},je[e].name)}))))))};var Ne=function(e){var t=e.context,n=e.instruments,i=Object(a.useState)([]),s=Object(o.a)(i,2),c=s[0],l=s[1],u=Object(a.useState)(!0),h=Object(o.a)(u,2),p=h[0],d=h[1],v=Object(a.useState)(""),g=Object(o.a)(v,2),y=g[0],w=g[1],k=Object(a.useState)(!1),E=Object(o.a)(k,2),x=E[0],_=E[1],j=Object(a.useState)(""),O=Object(o.a)(j,2),P=O[0],N=O[1],T=Object(a.useState)([]),M=Object(o.a)(T,2),A=M[0],I=M[1],L=new q({context:t});Object(a.useEffect)((function(){!function(e){var t=new RegExp("^(\\d+(\\.\\d+)?),(\\d+(\\.\\d+)?)$"),n=new RegExp("^[0-1]{1,}$");if(t.test(y)){var a=e.split(",").map((function(e){return parseInt(e)})).sort((function(e,t){return e-t})),r=Object(o.a)(a,2),i=r[0],s=r[1],c=f.a.getPattern(i,s).join("");N(c),d(!0),_(!1)}else n.test(y)?(N(y),d(!0),_(!1)):(""===e&&N(""),d(!1),_(!0))}(y)}),[P,y]);var D=function(e,t,n,a,r,i,s){if(s&&c.length>0){var o=c[0].sequence.length,u=e.length;if(u!==o){var m=t;if(o>u)m=t*(o/u);else m=t/(u/o)}}l((function(s){return s.concat({id:b.a.generate(),sequence:e,tempo:m||t,layer:n,clavis:a,channel:r,sample:i})}))},V=function(e){L.remove(e.layer),e.clavis.pause(),l(c.filter((function(t){return t.id!==e.id})))},G={layers:c,beet:L,pattern:y,setPattern:w,patternError:x,sequence:P,setPreview:d,handleStoreUpdate:function(e){e.instruments.forEach((function(e){var a=e.sequence,r=e.tempo,i=e.sample,s=e.polymetric;I([].concat(Object(m.a)(A),[{sequence:a,tempo:r,sample:i}])),function(e,a,r,i){d(!1);var s=L.pattern(e),o=new S,c=new C;c.configure(t,L,n[r]);var l={layer:L.layer(s,a,o,c.callbackOn)};l.layer.tempo=a,L.add(l.layer),D(e,a,l.layer,o,c,r,i)}(a,r,i,s)})),L.start()}};return r.a.createElement("div",{className:"App"},r.a.createElement(Pe,G),r.a.createElement("div",{className:"wrapper"},c.map((function(e){return r.a.createElement(R,{key:e.id,guia:e,removeLayer:V})})),p&&P.length>0&&r.a.createElement(B,{sequence:P,clavis:new S})))},Te=n(78),Me=n(118);var Ae=function(){return r.a.createElement(Me.a,{collapseOnSelect:!0,bg:"black",expand:"lg",variant:"black"},r.a.createElement(Me.a.Brand,null,r.a.createElement("h3",null,r.a.createElement(c.b,{to:"/"},"Polymatic ",r.a.createElement("small",null,Te.version)))),r.a.createElement(Me.a.Toggle,{"aria-controls":"responsive-navbar-nav"}))},Ie=function(){function e(t,n,a){Object(p.a)(this,e),this.context=t,this.instruments=n,this.onload=a,this.bufferList={},this.loadCount=0}return Object(d.a)(e,[{key:"loadBuffer",value:function(e,t){var n=this,a=new XMLHttpRequest;a.open("GET",this.instruments[e],!0),a.responseType="arraybuffer",a.onload=function(){n.context.decodeAudioData(a.response,(function(t){t?(n.bufferList[e]=t,++n.loadCount===Object.keys(n.instruments).length&&n.onload(n.bufferList)):alert("error decoding file data: "+e)}),(function(e){console.error("decodeAudioData error",e)}))},a.onerror=function(){alert("BufferLoader: XHR error")},a.send()}},{key:"load",value:function(){var e=this;Object.keys(this.instruments).forEach((function(t){e.loadBuffer(t)}))}}]),e}(),Re=(n(111),n(112),new AudioContext);var Be=function(){var e=Object(a.useState)(),t=Object(o.a)(e,2),n=t[0],i=t[1];u.a.initialize("UA-160360260-2"),u.a.pageview(window.location.pathname+window.location.search),window.AudioContext=window.AudioContext||window.webkitAudioContext;var s=function(e){return i(e)};return Object(a.useEffect)((function(){new Ie(Re,xe,s).load()}),[]),r.a.createElement(c.a,{basename:"/"},r.a.createElement(Ae,null),r.a.createElement(l.a,{exact:!0,path:"/",render:function(e){return r.a.createElement(Ne,Object.assign({},e,{instruments:n,context:Re}))}}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(Be,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},52:function(e,t,n){e.exports=n.p+"static/media/agogo1.b8f6e210.wav"},53:function(e,t,n){e.exports=n.p+"static/media/agogo2.5844966c.wav"},54:function(e,t,n){e.exports=n.p+"static/media/bass.b2419d4f.wav"},55:function(e,t,n){e.exports=n.p+"static/media/block.3753c44b.wav"},56:function(e,t,n){e.exports=n.p+"static/media/bum.4c11d5fa.wav"},57:function(e,t,n){e.exports=n.p+"static/media/claves.400c9ef3.wav"},58:function(e,t,n){e.exports=n.p+"static/media/conga1.41b2f57f.wav"},59:function(e,t,n){e.exports=n.p+"static/media/conga2.887c0c16.wav"},60:function(e,t,n){e.exports=n.p+"static/media/cymbal.950d832b.wav"},61:function(e,t,n){e.exports=n.p+"static/media/djembe1.f3e648cb.wav"},62:function(e,t,n){e.exports=n.p+"static/media/djembe3.acef368f.wav"},63:function(e,t,n){e.exports=n.p+"static/media/djembe2.d38ab3d2.wav"},64:function(e,t,n){e.exports=n.p+"static/media/hit.a315148b.wav"},65:function(e,t,n){e.exports=n.p+"static/media/hithat.950d832b.wav"},66:function(e,t,n){e.exports=n.p+"static/media/kick1.e63d68a9.wav"},67:function(e,t,n){e.exports=n.p+"static/media/kick2.18445a5e.wav"},68:function(e,t,n){e.exports=n.p+"static/media/kicklow.c09eab14.wav"},69:function(e,t,n){e.exports=n.p+"static/media/snare.96dbe59f.wav"},70:function(e,t,n){e.exports=n.p+"static/media/tamborim.a6cbfb58.wav"},78:function(e){e.exports=JSON.parse('{"name":"Polymatic","version":"3.3.0","private":true,"homepage":"https://polymatic.ciberterreiro.org","dependencies":{"@fortawesome/fontawesome-svg-core":"^1.2.27","@fortawesome/free-solid-svg-icons":"^5.12.1","@fortawesome/react-fontawesome":"^0.1.9","@testing-library/jest-dom":"^4.2.4","@testing-library/react":"^9.3.2","@testing-library/user-event":"^7.1.2","beet.js":"^1.7.0","bootstrap":"^4.4.1","euclidean-rhythms":"^2.0.1","gh-pages":"^2.2.0","melanke-watchjs":"^1.5.2","node-sass":"^4.13.1","react":"^16.13.0","react-bootstrap":"^1.0.0-beta.17","react-bootstrap-range-slider":"^0.3.1","react-dom":"^16.13.0","react-ga":"^2.7.0","react-router-dom":"^5.1.2","react-scripts":"3.4.0","shortid":"^2.2.15","watchjs":"^0.0.0","webworkify-webpack":"^2.1.5"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject","predeploy":"npm run build && cp CNAME build/CNAME","deploy":"gh-pages -b gh-pages -d build"},"eslintConfig":{"extends":"react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"semantic-release":"^17.0.7"}}')},82:function(e,t,n){e.exports=n(113)},87:function(e,t,n){},98:function(e,t,n){"use strict";n.r(t),t.default=function(e){var t=25,n=null;e.onmessage=function(e){"interval"===e.data&&(t=e.data.interval),"start"===e.data&&(n=setInterval((function(){postMessage("tick")}),t)),"stop"===e.data&&(clearInterval(n),n=null)}}}},[[82,1,2]]]);
//# sourceMappingURL=main.8f42da7c.chunk.js.map