(this.webpackJsonpPolymatic=this.webpackJsonpPolymatic||[]).push([[0],{34:function(e,t,n){e.exports=n.p+"static/media/agogo1.b8f6e210.wav"},35:function(e,t,n){e.exports=n.p+"static/media/agogo2.5844966c.wav"},36:function(e,t,n){e.exports=n.p+"static/media/bass.b2419d4f.wav"},37:function(e,t,n){e.exports=n.p+"static/media/block.3753c44b.wav"},38:function(e,t,n){e.exports=n.p+"static/media/bum.4c11d5fa.wav"},39:function(e,t,n){e.exports=n.p+"static/media/claves.400c9ef3.wav"},40:function(e,t,n){e.exports=n.p+"static/media/conga1.41b2f57f.wav"},41:function(e,t,n){e.exports=n.p+"static/media/conga2.887c0c16.wav"},42:function(e,t,n){e.exports=n.p+"static/media/cymbal.950d832b.wav"},43:function(e,t,n){e.exports=n.p+"static/media/djembe1.f3e648cb.wav"},44:function(e,t,n){e.exports=n.p+"static/media/djembe3.acef368f.wav"},45:function(e,t,n){e.exports=n.p+"static/media/djembe2.d38ab3d2.wav"},46:function(e,t,n){e.exports=n.p+"static/media/hit.a315148b.wav"},47:function(e,t,n){e.exports=n.p+"static/media/hithat.950d832b.wav"},48:function(e,t,n){e.exports=n.p+"static/media/kick1.e63d68a9.wav"},49:function(e,t,n){e.exports=n.p+"static/media/kick2.18445a5e.wav"},50:function(e,t,n){e.exports=n.p+"static/media/kicklow.c09eab14.wav"},51:function(e,t,n){e.exports=n.p+"static/media/snare.96dbe59f.wav"},52:function(e,t,n){e.exports=n.p+"static/media/tamborim.a6cbfb58.wav"},66:function(e,t,n){e.exports=n(94)},71:function(e,t,n){},84:function(e,t,n){"use strict";n.r(t),t.default=function(e){var t=25,n=null;e.onmessage=function(e){"interval"===e.data&&(t=e.data.interval),"start"===e.data&&(n=setInterval((function(){postMessage("tick")}),t)),"stop"===e.data&&(clearInterval(n),n=null)}}},93:function(e,t,n){},94:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(23),s=n.n(r),o=(n(71),n(65)),c=n(7),u=n(30),l=n(24),h=n.n(l),m=n(12),p=n(13),f=n(8),v=n.n(f),d=n(32),b=n.n(d).a.watch;function y(e,t){var n=this;return n._createSequence(e,t),b(this,["pulses","steps"],(function(){n.update(this.pulses,this.steps)})),this}y.prototype.update=function(e,t){return this._createSequence(e,t),this},y.prototype.shift=function(e){var t=e>this.seq.length?e-=this.seq.length:e;if(t===this.seq.length)return this;for(var n=this.seq.splice(this.seq.length-t,t),a=0;a<n.length;a++)this.seq.unshift(n[a]);return this},y.prototype._createSequence=function(e,t){var n=typeof e;return"number"===n?(this.pulses=e,this.steps=t||e,this.seq=h()(this.pulses,this.steps).split("")):"string"===n&&(this.steps=e.length,this.seq=e.split("")),this};var g=y,w=n(33),k=n.n(w);function x(e,t){var n=this;if(!e)throw new Error("Context is mandatory");if(!t)throw new Error("Callback is mandatory");this.context=e,this.steps=16,this.tempo=120,this.callback=t,this.look_ahead=1,this._step=1,this._scheduler_interval=20,this._next_event_time=0,this._first=!0,this._is_running=!1,this._worker=k()(84),this._worker.onmessage=function(e){"tick"===e.data&&n._is_running&&n._scheduler()},this._worker.postMessage({interval:n._scheduler_interval})}x.prototype.start=function(e){this._is_running?console.log("already started"):(this._is_running=!0,this._worker.postMessage("start"))},x.prototype.pause=function(){this._is_running=!1,this._worker.postMessage("stop")},x.prototype.stop=function(){this._first=!0,this._step=1,this._is_running=!1,this._worker.postMessage("stop")},x.prototype._scheduler=function(){for(1===this._step&&this._first&&(this._next_event_time=this.context.currentTime);this._next_event_time<this.context.currentTime+this.look_ahead;){var e=this._next_event_time-this.context.currentTime;this.callback(this._next_event_time,this._step,e),this._next()}},x.prototype._next=function(){this._step++,this._first&&(this._next_event_time=this.context.currentTime,this._first=!1),this._step>this.steps&&(this._step=1),this._next_event_time+=60/this.tempo*4/this.steps};var _=x,E=function(){function e(t,n,a,i,r,s,o){var c=this;Object(m.a)(this,e),o||(o=function(){}),this.id=t,this.on=s,this.off=o,this.tempo=a,this.clavis=i,this.context=n,this.sequence=r,this.metro=new _(n,(function(e,t,n){c.metro.steps!==c.sequence.seq.length&&(c.metro.steps=c.sequence.seq.length),"1"===r.seq[t-1]?(c.on(e,t,n),setTimeout((function(){i.setCurrentStep(t)}),1e3)):(c.off(e,t,n),setTimeout((function(){i.setCurrentStep(t)}),1e3))})),this.metro.steps=r.seq.length,this.metro.tempo=this.tempo}return Object(p.a)(e,[{key:"start",value:function(){this.metro.start()}},{key:"pause",value:function(){this.metro.pause()}},{key:"stop",value:function(){this.metro.stop()}},{key:"watch",value:function(e){this.metro.tempo=e}}]),e}(),j=function(){function e(t){var n=t.context,a=t.tempo;Object(m.a)(this,e),this.context=n,this.tempo=a||120,this.layers=[]}return Object(p.a)(e,[{key:"layer",value:function(e,t,n,a){return new E(v.a.generate(),this.context,this.tempo,t,e,n,a)}},{key:"pattern",value:function(e,t){return new g(e,t)}},{key:"add",value:function(e){this.layers.push(e)}},{key:"remove",value:function(e){e.metro.stop(),this.layers=this.layers.filter((function(t){return t.id!==e.id}))}},{key:"start",value:function(){this.layers.forEach((function(e){e.start()}))}},{key:"pause",value:function(){this.layers.forEach((function(e){e.pause()}))}},{key:"load",value:function(e,t,n,a){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){e.decodeAudioData(i.response,n,a)},i.onerror=a,i.send()}},{key:"envelope",value:function(e,t,n){n||(n={});var a=n.peak||e.defaultValue;0===n.start&&(n.start=1e-6);var i=n.start||e.value,r=n.attack||.1,s=n.decay||0,o=n.sustain||a,c=n.release||.5;e.setValueAtTime(i,t),e.linearRampToValueAtTime(a,t+r),e.linearRampToValueAtTime(o,t+r+s),e.linearRampToValueAtTime(0,t+r+s+c)}},{key:"changeTempo",value:function(e){var t=!0,n=!1,a=void 0;try{for(var i,r=this.layers[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){i.value.metro.tempo=e}}catch(s){n=!0,a=s}finally{try{t||null==r.return||r.return()}finally{if(n)throw a}}}}]),e}(),O=function(){function e(){Object(m.a)(this,e),this.canvas=null,this.context=null,this.pattern=null,this.tempo=0,this.animate=!1,this.lastRender=Date.now(),this.draw=this.draw.bind(this),this.currentStep=1,this.patternPos={}}return Object(p.a)(e,[{key:"configure",value:function(e,t,n){this.canvas=e,this.context=e.getContext("2d"),this.pattern=t,this.tempo=n}},{key:"setCurrentStep",value:function(e){this.currentStep=e}},{key:"play",value:function(){this.animate=!0,window.requestAnimationFrame(this.draw)}},{key:"pause",value:function(){this.animate=!1}},{key:"draw",value:function(){var e=this.canvas,t=this.context,n=this.pattern,a="20px",i=2,r="#ccc",s="#000",o=4,u="#000",l="#000",h=2,m="#ccc",p="#ccc",f=5,v="#fc0",d="#fc0",b=[200,200],y=b[0],g=b[1],w=80,k=2*Math.PI/n.length,x=-.5*Math.PI;function _(e,n,a){var i=a.radius,r=a.stroke,s=a.fill;t.strokeStyle=r,t.fillStyle=s,t.beginPath(),t.arc(e,n,i,0,2*Math.PI),t.fill(),t.stroke()}function E(e,t){_(e,t,{radius:o,stroke:u,fill:l})}function j(e,t){_(e,t,{radius:h,stroke:m,fill:p})}e.style.padding=a,e.width=y,e.height=g,t.clearRect(0,0,y,g),t.lineWidth=i,t.strokeStyle=r,t.beginPath(),t.arc(y/2,g/2,w,0,2*Math.PI),t.stroke();var O=[];function q(e,t){return[Math.cos(e)*t+y/2,Math.sin(e)*t+g/2]}for(var S=0;S<n.length;S++){var P=q(x+k*S,w),C=Object(c.a)(P,2),T=C[0],A=C[1];"1"===n[S]?(E(T,A),O.push([T,A])):j(T,A),this.patternPos[S]={x:T,y:A}}O.length>=1&&function(e){t.strokeStyle=s,t.beginPath(),t.moveTo(e[0][0],e[0][1]);for(var n=1;n<e.length;n++)t.lineTo(e[n][0],e[n][1]);t.closePath(),t.stroke()}(O),function(e,t){_(e,t,{radius:f,stroke:v,fill:d})}(this.patternPos[this.currentStep-1].x,this.patternPos[this.currentStep-1].y),this.animate&&window.requestAnimationFrame(this.draw)}}]),e}(),q=function(){function e(){var t=this;Object(m.a)(this,e),this.callbackOn=function(e,n){var a=t.context.createGain();a.gain.value=t.volume,a.connect(t.context.destination);var i=t.context.createBufferSource();t.beet.load(t.beet.context,t.instrument,(function(t){i.buffer=t,i.connect(a),i.start(e)}))},this.volume=1,this.context=null,this.beet=null,this.instrument=null}return Object(p.a)(e,[{key:"configure",value:function(e,t,n){this.context=e,this.beet=t,this.instrument=n}},{key:"setVolume",value:function(e){this.volume=e}},{key:"getVolume",value:function(){return this.volume}}]),e}(),S=n(34),P=n.n(S),C=n(35),T=n.n(C),A=n(36),N=n.n(A),M=n(37),R=n.n(M),I=n(38),V=n.n(I),B=n(39),L=n.n(B),U=n(40),W=n.n(U),$=n(41),z=n.n($),D=n(42),F=n.n(D),G=n(43),J=n.n(G),H=n(44),X=n.n(H),K=n(45),Q=n.n(K),Y=n(46),Z=n.n(Y),ee=n(47),te=n.n(ee),ne=n(48),ae=n.n(ne),ie=n(49),re=n.n(ie),se=n(50),oe=n.n(se),ce=n(51),ue=n.n(ce),le=n(52),he=n.n(le),me={agogo1:P.a,agogo2:T.a,bass:N.a,block:R.a,bum:V.a,claves:L.a,conga1:W.a,conga2:z.a,cymbal:F.a,djembe1:J.a,djembe2:X.a,djembe3:Q.a,hit:Z.a,hithat:te.a,kick1:ae.a,kick2:re.a,kicklow:oe.a,snare:ue.a,tamborim:he.a},pe=n(53),fe=n.n(pe),ve=(n(85),n(14)),de=n(15);function be(e){var t=e.guia,n=e.removeLayer,r=Object(a.useRef)(),s=Object(a.useState)(100),o=Object(c.a)(s,2),u=o[0],l=o[1],h=t.sequence,m=t.tempo,p=t.layer,f=t.clavis,d=t.channel;Object(a.useEffect)((function(){f.configure(r.current,h,m),f.play()}));return i.a.createElement("div",{className:"layer"},i.a.createElement("canvas",{id:v.a.generate(),ref:r,width:640,height:425}),n&&i.a.createElement("div",{className:"controls"},i.a.createElement("button",{onClick:function(){return p.start(),void f.play()}},i.a.createElement(ve.a,{icon:de.a})),i.a.createElement("button",{onClick:function(){return p.stop(),void f.pause()}},i.a.createElement(ve.a,{icon:de.b})),i.a.createElement("button",{onClick:function(){return n(t)}},i.a.createElement(ve.a,{icon:de.c}))),i.a.createElement("div",{className:"mt-2"},i.a.createElement(fe.a,{value:u,min:0,max:100,tooltipLabel:function(e){return"".concat(e,"%")},onChange:function(e){return function(e){var t=function(e,t,n,a,i){return a+(i-a)*(e-t)/(n-t)}(e,0,100,0,1);l(e),d.setVolume(t)}(Number(e.target.value))}})))}function ye(e){e.preview;var t=e.sequence,n=e.clavis,r=Object(a.useRef)();return Object(a.useEffect)((function(){n.configure(r.current,t,120),n.draw()})),i.a.createElement("div",{className:"layer"},i.a.createElement("canvas",{id:v.a.generate(),ref:r,width:640,height:425}),i.a.createElement("p",{className:"Preview"},"Pr\xe9-visualiza\xe7\xe3o"))}var ge,we=n(28),ke=(ge={},Object(we.a)(ge,v.a.generate(),{name:"Rumba",instruments:[{sequence:"1001000100101000",tempo:120,sample:"conga1"}]}),Object(we.a)(ge,v.a.generate(),{name:"Centro de gravidade",instruments:[{sequence:"10101",tempo:120,sample:"bum"},{sequence:"10110101",tempo:120,sample:"bass"}]}),Object(we.a)(ge,v.a.generate(),{name:"Proporcional",instruments:[{sequence:"1010101010101101",tempo:30,sample:"conga1"},{sequence:"1111",tempo:30,sample:"conga2"}]}),ge),xe=n(96),_e=n(55),Ee=n(97),je=n(56),Oe=n(99),qe=n(98);var Se=function(e){var t=e.layers,n=(e.beet,e.pattern),r=e.setPattern,s=e.patternError,o=e.sequence,u=(e.setPreview,e.handleStoreUpdate),l=Object(a.useState)("agogo1"),h=Object(c.a)(l,2),m=h[0],p=h[1],f=Object(a.useState)(120),d=Object(c.a)(f,2),b=d[0],y=d[1];return i.a.createElement("div",{className:"header"},i.a.createElement("div",null,i.a.createElement("h1",{className:"header-logo"},"Polymatic ",i.a.createElement("small",null,"v3.1.1"))),i.a.createElement("div",{className:"header-controls"},i.a.createElement(xe.a,{"aria-label":"Basic example"},i.a.createElement(_e.a,{variant:"secondary",onClick:function(){return function(){var e=!0,n=!1,a=void 0;try{for(var i,r=t[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var s=i.value;s.layer.start(),s.clavis.play()}}catch(o){n=!0,a=o}finally{try{e||null==r.return||r.return()}finally{if(n)throw a}}}()}},i.a.createElement(ve.a,{icon:de.a})),i.a.createElement(_e.a,{variant:"secondary",onClick:function(){return function(){var e=!0,n=!1,a=void 0;try{for(var i,r=t[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var s=i.value;s.layer.stop(),s.clavis.pause()}}catch(o){n=!0,a=o}finally{try{e||null==r.return||r.return()}finally{if(n)throw a}}}()}},i.a.createElement(ve.a,{icon:de.b})))),i.a.createElement("div",{className:"header-form"},i.a.createElement(Ee.a,null,i.a.createElement(Ee.a.Prepend,null,i.a.createElement(Ee.a.Text,{id:"basic-addon3"},"Padr\xe3o")),i.a.createElement(je.a,{placeholder:"1010101 ou 3,4",value:n,onChange:function(e){return r(e.target.value)},isInvalid:n.length>0&&s})),i.a.createElement(Ee.a,null,i.a.createElement(Ee.a.Prepend,null,i.a.createElement(Ee.a.Text,{id:"basic-addon3"},"Tempo")),i.a.createElement(je.a,{placeholder:"tempo",value:b,onChange:function(e){return y(e.target.value)}})),i.a.createElement(Oe.a.Control,{as:"select",onChange:function(e){return p(e.target.value)}},Object.keys(me).map((function(e,t){return i.a.createElement("option",{key:t,value:e},e)}))),i.a.createElement(_e.a,{className:"ml-2",onClick:function(){return function(){var e={name:v.a.generate(),instruments:[{sequence:o,tempo:b,sample:m}]};u(e)}()},disabled:s},"Adicionar"),i.a.createElement(qe.a,{className:"ml-2"},i.a.createElement(qe.a.Toggle,{variant:"info",id:"dropdown-basic"},"presets"),i.a.createElement(qe.a.Menu,null,Object.keys(ke).map((function(e,t){return i.a.createElement(qe.a.Item,{key:t,onClick:function(){u(ke[e])}},ke[e].name)}))))))};n(92),n(93);var Pe=function(){var e=Object(a.useState)([]),t=Object(c.a)(e,2),n=t[0],r=t[1],s=Object(a.useState)(!0),l=Object(c.a)(s,2),m=l[0],p=l[1],f=Object(a.useState)(""),d=Object(c.a)(f,2),b=d[0],y=d[1],g=Object(a.useState)(!1),w=Object(c.a)(g,2),k=w[0],x=w[1],_=Object(a.useState)(""),E=Object(c.a)(_,2),S=E[0],P=E[1],C=Object(a.useState)([]),T=Object(c.a)(C,2),A=T[0],N=T[1];u.a.initialize("UA-160360260-2"),u.a.pageview(window.location.pathname+window.location.search),window.AudioContext=window.AudioContext||window.webkitAudioContext;var M=new AudioContext,R=new j({context:M,tempo:120});Object(a.useEffect)((function(){!function(e){var t=new RegExp("^(\\d+(\\.\\d+)?),(\\d+(\\.\\d+)?)$"),n=new RegExp("^[0-1]{1,}$");if(t.test(b)){var a=e.split(",").map((function(e){return parseInt(e)})).sort((function(e,t){return e-t})),i=Object(c.a)(a,2),r=i[0],s=i[1],o=h()(r,s);P(o),p(!0),x(!1)}else n.test(b)?(P(b),p(!0),x(!1)):(""===e&&P(""),p(!1),x(!0))}(b)}),[S,b]);var I=function(e,t,n,a,i){r((function(r){return r.concat({id:v.a.generate(),sequence:e,tempo:t,layer:n,clavis:a,channel:i})}))},V=function(e){R.remove(e.layer),e.clavis.pause(),r(n.filter((function(t){return t.id!==e.id})))},B={layers:n,beet:R,pattern:b,setPattern:y,patternError:k,sequence:S,setPreview:p,handleStoreUpdate:function(e){e.instruments.map((function(e){var t=e.sequence,n=e.tempo,a=e.sample;N([].concat(Object(o.a)(A),[{sequence:t,tempo:n,sample:a}])),function(e,t,n){p(!1);var a=R.pattern(e),i=new O,r=new q;r.configure(M,R,me[n]);var s={layer:R.layer(a,i,r.callbackOn)};s.layer.tempo=t,R.add(s.layer),I(e,t,s.layer,i,r)}(t,n,a)})),R.start()}};return i.a.createElement("div",{className:"App"},i.a.createElement(Se,B),i.a.createElement("div",{className:"wrapper"},n.map((function(e){return i.a.createElement(be,{key:e.id,guia:e,removeLayer:V})})),m&&S.length>0&&i.a.createElement(ye,{sequence:S,clavis:new O})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(i.a.createElement(Pe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[66,1,2]]]);
//# sourceMappingURL=main.3b2452fe.chunk.js.map