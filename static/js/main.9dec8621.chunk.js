(this.webpackJsonpPolymatic=this.webpackJsonpPolymatic||[]).push([[0],{24:function(t,e,n){t.exports=n.p+"static/media/hit2.f3e648cb.wav"},28:function(t,e,n){t.exports=n(54)},33:function(t,e,n){},44:function(t,e,n){"use strict";n.r(e),e.default=function(t){var e=25,n=null;t.onmessage=function(t){"interval"===t.data&&(e=t.data.interval),"start"===t.data&&(n=setInterval((function(){postMessage("tick")}),e)),"stop"===t.data&&(clearInterval(n),n=null)}}},53:function(t,e,n){},54:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),i=n(21),s=n.n(i),o=(n(33),n(27)),c=n(9),l=n(14),u=n(15),h=n(10),p=n.n(h),f=n(22),m=n.n(f),d=n(16),v=n.n(d),y=v.a.watch;function _(t,e){var n=this;return n._createSequence(t,e),y(this,["pulses","steps"],(function(){n.update(this.pulses,this.steps)})),this}_.prototype.update=function(t,e){return this._createSequence(t,e),this},_.prototype.shift=function(t){var e=t>this.seq.length?t-=this.seq.length:t;if(e===this.seq.length)return this;for(var n=this.seq.splice(this.seq.length-e,e),a=0;a<n.length;a++)this.seq.unshift(n[a]);return this},_.prototype._createSequence=function(t,e){var n=typeof t;return"number"===n?(this.pulses=t,this.steps=e||t,this.seq=m()(this.pulses,this.steps).split("")):"string"===n&&(this.steps=t.length,this.seq=t.split("")),this};var g=_,k=n(23),w=n.n(k);function b(t,e){var n=this;if(!t)throw new Error("Context is mandatory");if(!e)throw new Error("Callback is mandatory");this.context=t,this.steps=16,this.tempo=120,this.callback=e,this.look_ahead=1,this._step=1,this._scheduler_interval=20,this._next_event_time=0,this._first=!0,this._is_running=!1,this._worker=w()(44),this._worker.onmessage=function(t){"tick"===t.data&&n._is_running&&n._scheduler()},this._worker.postMessage({interval:n._scheduler_interval})}b.prototype.start=function(t){this._is_running?console.log("already started"):(this._is_running=!0,this._worker.postMessage("start"))},b.prototype.pause=function(){this._is_running=!1,this._worker.postMessage("stop")},b.prototype.stop=function(){this._first=!0,this._step=1,this._is_running=!1,this._worker.postMessage("stop")},b.prototype._scheduler=function(){for(1===this._step&&this._first&&(this._next_event_time=this.context.currentTime);this._next_event_time<this.context.currentTime+this.look_ahead;){var t=this._next_event_time-this.context.currentTime;this.callback(this._next_event_time,this._step,t),this._next()}},b.prototype._next=function(){this._step++,this._first&&(this._next_event_time=this.context.currentTime,this._first=!1),this._step>this.steps&&(this._step=1),this._next_event_time+=60/this.tempo*4/this.steps};var E=b,x=v.a.watch;function S(t,e,n,a,r,i,s){s||(s=function(){});var o=this;this.id=t,this.on=i,this.off=s,this.tempo=n,this.clavis=a,o.metro=new E(e,(function(t,e,n){o.metro.steps!==r.seq.length&&(o.metro.steps=r.seq.length),"1"===r.seq[e-1]?(o.on(t,e,n),setTimeout((function(){a.setCurrentStep(e)}),1e3)):(o.off(t,e,n),setTimeout((function(){a.setCurrentStep(e)}),1e3))})),this.metro.steps=r.seq.length,this.metro.tempo=this.tempo,x(o,["tempo"],(function(){o.metro.tempo=o.tempo}))}S.prototype.start=function(){return this.metro.start(),this},S.prototype.pause=function(){return this.metro.pause(),this},S.prototype.stop=function(){return this.metro.stop(),this};var T=S,C=function(){function t(e){var n=e.context,a=e.tempo;Object(l.a)(this,t),this.context=n,this.tempo=a||120,this.layers=[]}return Object(u.a)(t,[{key:"layer",value:function(t,e,n,a){return new T(p.a.generate(),this.context,this.tempo,e,t,n,a)}},{key:"pattern",value:function(t,e){return new g(t,e)}},{key:"add",value:function(t){this.layers.push(t)}},{key:"remove",value:function(t){t.metro.stop(),this.layers=this.layers.filter((function(e){return e.id!==t.id}))}},{key:"start",value:function(){this.layers.forEach((function(t){t.start()}))}},{key:"pause",value:function(){this.layers.forEach((function(t){t.pause()}))}},{key:"load",value:function(t,e,n,a){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){t.decodeAudioData(r.response,n,a)},r.onerror=a,r.send()}},{key:"envelope",value:function(t,e,n){n||(n={});var a=n.peak||t.defaultValue;0===n.start&&(n.start=1e-6);var r=n.start||t.value,i=n.attack||.1,s=n.decay||0,o=n.sustain||a,c=n.release||.5;t.setValueAtTime(r,e),t.linearRampToValueAtTime(a,e+i),t.linearRampToValueAtTime(o,e+i+s),t.linearRampToValueAtTime(0,e+i+s+c)}},{key:"changeTempo",value:function(t){var e=!0,n=!1,a=void 0;try{for(var r,i=this.layers[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){r.value.metro.tempo=t}}catch(s){n=!0,a=s}finally{try{e||null==i.return||i.return()}finally{if(n)throw a}}}}]),t}(),q=function(){function t(){Object(l.a)(this,t),this.canvas=null,this.context=null,this.pattern=null,this.tempo=0,this.animate=!1,this.lastRender=Date.now(),this.draw=this.draw.bind(this),this.currentStep=1,this.patternPos={}}return Object(u.a)(t,[{key:"configure",value:function(t,e,n){this.canvas=t,this.context=t.getContext("2d"),this.pattern=e,this.tempo=n}},{key:"setCurrentStep",value:function(t){this.currentStep=t}},{key:"play",value:function(){this.animate=!0,window.requestAnimationFrame(this.draw)}},{key:"pause",value:function(){this.animate=!1}},{key:"draw",value:function(){var t=this.canvas,e=this.context,n=this.pattern,a="20px",r=2,i="#ccc",s="#000",o=4,l="#000",u="#000",h=2,p="#ccc",f="#ccc",m=5,d="#fc0",v="#fc0",y=[200,200],_=y[0],g=y[1],k=80,w=2*Math.PI/n.length,b=-.5*Math.PI;function E(t,n,a){var r=a.radius,i=a.stroke,s=a.fill;e.strokeStyle=i,e.fillStyle=s,e.beginPath(),e.arc(t,n,r,0,2*Math.PI),e.fill(),e.stroke()}function x(t,e){E(t,e,{radius:o,stroke:l,fill:u})}function S(t,e){E(t,e,{radius:h,stroke:p,fill:f})}t.style.padding=a,t.width=_,t.height=g,e.clearRect(0,0,_,g),e.lineWidth=r,e.strokeStyle=i,e.beginPath(),e.arc(_/2,g/2,k,0,2*Math.PI),e.stroke();var T=[];function C(t,e){return[Math.cos(t)*e+_/2,Math.sin(t)*e+g/2]}for(var q=0;q<n.length;q++){var P=C(b+w*q,k),O=Object(c.a)(P,2),j=O[0],A=O[1];"1"===n[q]?(x(j,A),T.push([j,A])):S(j,A),this.patternPos[q]={x:j,y:A}}!function(t){e.strokeStyle=s,e.beginPath(),e.moveTo(t[0][0],t[0][1]);for(var n=1;n<t.length;n++)e.lineTo(t[n][0],t[n][1]);e.closePath(),e.stroke()}(T),function(t,e){E(t,e,{radius:m,stroke:d,fill:v})}(this.patternPos[this.currentStep-1].x,this.patternPos[this.currentStep-1].y),this.animate&&window.requestAnimationFrame(this.draw)}}]),t}(),P=n(24),O=n.n(P),j=n(7),A=n(8);function M(t){var e=t.guia,n=t.removeLayer,i=Object(a.useRef)(),s=e.sequence,o=e.tempo,c=e.layer,l=e.clavis;Object(a.useEffect)((function(){l.configure(i.current,s,o),l.play()}));return r.a.createElement("div",{className:"layer"},r.a.createElement("canvas",{id:p.a.generate(),ref:i,width:640,height:425}),r.a.createElement("div",{className:"controls"},r.a.createElement("button",{onClick:function(){return c.start(),void l.play()}},r.a.createElement(j.a,{icon:A.a})),r.a.createElement("button",{onClick:function(){return c.stop(),void l.pause()}},r.a.createElement(j.a,{icon:A.b})),r.a.createElement("button",{onClick:function(){return n(e)}},r.a.createElement(j.a,{icon:A.c}))))}var N=n(56),I=n(59),R=n(57),L=n(26),V=n(58);var B=function(t){var e=t.layers,n=t.pattern,a=t.setPattern,i=t.setCallback,s=(t.beet,t.tempo),o=t.setTempo,c=t.addLayer;return r.a.createElement("div",{className:"header"},r.a.createElement("div",null,r.a.createElement("h1",{className:"header-logo"},"Polymatic ",r.a.createElement("small",null,"v3"))),r.a.createElement("div",{className:"header-controls"},r.a.createElement(N.a,{"aria-label":"Basic example"},r.a.createElement(I.a,{variant:"secondary",onClick:function(){return function(){var t=!0,n=!1,a=void 0;try{for(var r,i=e[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var s=r.value;s.layer.start(),s.clavis.play()}}catch(o){n=!0,a=o}finally{try{t||null==i.return||i.return()}finally{if(n)throw a}}}()}},r.a.createElement(j.a,{icon:A.a})),r.a.createElement(I.a,{variant:"secondary",onClick:function(){return function(){var t=!0,n=!1,a=void 0;try{for(var r,i=e[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var s=r.value;s.layer.stop(),s.clavis.pause()}}catch(o){n=!0,a=o}finally{try{t||null==i.return||i.return()}finally{if(n)throw a}}}()}},r.a.createElement(j.a,{icon:A.b})))),r.a.createElement("div",{className:"header-form"},r.a.createElement(R.a,null,r.a.createElement(R.a.Prepend,null,r.a.createElement(R.a.Text,{id:"basic-addon3"},"Padr\xe3o")),r.a.createElement(L.a,{placeholder:"padr\xe3o",value:n,onChange:function(t){return a(t.target.value)}})),r.a.createElement(R.a,null,r.a.createElement(R.a.Prepend,null,r.a.createElement(R.a.Text,{id:"basic-addon3"},"Tempo")),r.a.createElement(L.a,{placeholder:"tempo",value:s,onChange:function(t){return o(t.target.value)}})),r.a.createElement(V.a.Control,{as:"select",onChange:function(t){return i(t.target.value)}},r.a.createElement("option",{value:"drum"},"drum"),r.a.createElement("option",{value:"synth"},"synth")),r.a.createElement(I.a,{onClick:function(){return c()}},"Adicionar")))};n(52),n(53);var W=function(){var t={drum:function(t,e){var n=b.createBufferSource();E.load(E.context,O.a,(function(e){n.buffer=e,n.connect(b.destination),n.start(t)}))},synth:function(t,e){console.log("Step: ",e);var n=b.createOscillator(),a=b.createGain();n.connect(a),a.connect(b.destination),n.frequency.value=277,E.envelope(a.gain,t,{start:0,peake:.5,attack:.02,decay:.1,sustain:.1,release:.2}),n.start(t),n.stop(t+.5)}},e=Object(a.useState)("1000101000101000"),n=Object(c.a)(e,2),i=n[0],s=n[1],l=Object(a.useState)(120),u=Object(c.a)(l,2),h=u[0],f=u[1],m=Object(a.useState)([]),d=Object(c.a)(m,2),v=d[0],y=d[1],_=Object(a.useState)("drum"),g=Object(c.a)(_,2),k=g[0],w=g[1];window.AudioContext=window.AudioContext||window.webkitAudioContext;var b=new AudioContext,E=new C({context:b,tempo:h}),x=function(t){E.remove(t.layer),t.clavis.pause(),y(v.filter((function(e){return e.id!==t.id})))},S={layers:v,pattern:i,setPattern:s,setCallback:w,beet:E,tempo:h,setTempo:f,addLayer:function(){var e=E.pattern(i),n=new q,a={layer:E.layer(e,n,t[k])};a.layer.tempo=h,E.add(a.layer),E.start(),y([].concat(Object(o.a)(v),[{id:p.a.generate(),sequence:i,tempo:h,layer:a.layer,clavis:n}]))}};return r.a.createElement("div",{className:"App"},r.a.createElement(B,S),r.a.createElement("div",{className:"wrapper"},v.map((function(t){return r.a.createElement(M,{key:t.id,guia:t,removeLayer:x})}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(W,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[28,1,2]]]);
//# sourceMappingURL=main.9dec8621.chunk.js.map