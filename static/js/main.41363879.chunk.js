(this.webpackJsonpPolymatic=this.webpackJsonpPolymatic||[]).push([[0],{24:function(t,e,a){t.exports=a.p+"static/media/drum1.0d8060e3.wav"},25:function(t,e,a){t.exports=a.p+"static/media/drum2.f3e648cb.wav"},26:function(t,e,a){t.exports=a.p+"static/media/drum3.d38ab3d2.wav"},27:function(t,e,a){t.exports=a.p+"static/media/drum4.d112bca9.wav"},28:function(t,e,a){t.exports=a.p+"static/media/drum5.b8b3aa8f.wav"},29:function(t,e,a){t.exports=a.p+"static/media/drum6.acef368f.wav"},30:function(t,e,a){t.exports=a.p+"static/media/claves.400c9ef3.wav"},31:function(t,e,a){t.exports=a.p+"static/media/cymbal.950d832b.wav"},35:function(t,e,a){t.exports=a(61)},40:function(t,e,a){},51:function(t,e,a){"use strict";a.r(e),e.default=function(t){var e=25,a=null;t.onmessage=function(t){"interval"===t.data&&(e=t.data.interval),"start"===t.data&&(a=setInterval((function(){postMessage("tick")}),e)),"stop"===t.data&&(clearInterval(a),a=null)}}},60:function(t,e,a){},61:function(t,e,a){"use strict";a.r(e);var n=a(0),r=a.n(n),i=a(21),s=a.n(i),o=(a(40),a(34)),c=a(7),l=a(14),u=a(15),h=a(10),p=a.n(h),m=a(22),f=a.n(m),d=a(16),v=a.n(d),y=v.a.watch;function _(t,e){var a=this;return a._createSequence(t,e),y(this,["pulses","steps"],(function(){a.update(this.pulses,this.steps)})),this}_.prototype.update=function(t,e){return this._createSequence(t,e),this},_.prototype.shift=function(t){var e=t>this.seq.length?t-=this.seq.length:t;if(e===this.seq.length)return this;for(var a=this.seq.splice(this.seq.length-e,e),n=0;n<a.length;n++)this.seq.unshift(a[n]);return this},_.prototype._createSequence=function(t,e){var a=typeof t;return"number"===a?(this.pulses=t,this.steps=e||t,this.seq=f()(this.pulses,this.steps).split("")):"string"===a&&(this.steps=t.length,this.seq=t.split("")),this};var w=_,g=a(23),b=a.n(g);function k(t,e){var a=this;if(!t)throw new Error("Context is mandatory");if(!e)throw new Error("Callback is mandatory");this.context=t,this.steps=16,this.tempo=120,this.callback=e,this.look_ahead=1,this._step=1,this._scheduler_interval=20,this._next_event_time=0,this._first=!0,this._is_running=!1,this._worker=b()(51),this._worker.onmessage=function(t){"tick"===t.data&&a._is_running&&a._scheduler()},this._worker.postMessage({interval:a._scheduler_interval})}k.prototype.start=function(t){this._is_running?console.log("already started"):(this._is_running=!0,this._worker.postMessage("start"))},k.prototype.pause=function(){this._is_running=!1,this._worker.postMessage("stop")},k.prototype.stop=function(){this._first=!0,this._step=1,this._is_running=!1,this._worker.postMessage("stop")},k.prototype._scheduler=function(){for(1===this._step&&this._first&&(this._next_event_time=this.context.currentTime);this._next_event_time<this.context.currentTime+this.look_ahead;){var t=this._next_event_time-this.context.currentTime;this.callback(this._next_event_time,this._step,t),this._next()}},k.prototype._next=function(){this._step++,this._first&&(this._next_event_time=this.context.currentTime,this._first=!1),this._step>this.steps&&(this._step=1),this._next_event_time+=60/this.tempo*4/this.steps};var x=k,E=v.a.watch;function S(t,e,a,n,r,i,s){s||(s=function(){});var o=this;this.id=t,this.on=i,this.off=s,this.tempo=a,this.clavis=n,o.metro=new x(e,(function(t,e,a){o.metro.steps!==r.seq.length&&(o.metro.steps=r.seq.length),"1"===r.seq[e-1]?(o.on(t,e,a),setTimeout((function(){n.setCurrentStep(e)}),1e3)):(o.off(t,e,a),setTimeout((function(){n.setCurrentStep(e)}),1e3))})),this.metro.steps=r.seq.length,this.metro.tempo=this.tempo,E(o,["tempo"],(function(){o.metro.tempo=o.tempo}))}S.prototype.start=function(){return this.metro.start(),this},S.prototype.pause=function(){return this.metro.pause(),this},S.prototype.stop=function(){return this.metro.stop(),this};var T=S,P=function(){function t(e){var a=e.context,n=e.tempo;Object(l.a)(this,t),this.context=a,this.tempo=n||120,this.layers=[]}return Object(u.a)(t,[{key:"layer",value:function(t,e,a,n){return new T(p.a.generate(),this.context,this.tempo,e,t,a,n)}},{key:"pattern",value:function(t,e){return new w(t,e)}},{key:"add",value:function(t){this.layers.push(t)}},{key:"remove",value:function(t){t.metro.stop(),this.layers=this.layers.filter((function(e){return e.id!==t.id}))}},{key:"start",value:function(){this.layers.forEach((function(t){t.start()}))}},{key:"pause",value:function(){this.layers.forEach((function(t){t.pause()}))}},{key:"load",value:function(t,e,a,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){t.decodeAudioData(r.response,a,n)},r.onerror=n,r.send()}},{key:"envelope",value:function(t,e,a){a||(a={});var n=a.peak||t.defaultValue;0===a.start&&(a.start=1e-6);var r=a.start||t.value,i=a.attack||.1,s=a.decay||0,o=a.sustain||n,c=a.release||.5;t.setValueAtTime(r,e),t.linearRampToValueAtTime(n,e+i),t.linearRampToValueAtTime(o,e+i+s),t.linearRampToValueAtTime(0,e+i+s+c)}},{key:"changeTempo",value:function(t){var e=!0,a=!1,n=void 0;try{for(var r,i=this.layers[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){r.value.metro.tempo=t}}catch(s){a=!0,n=s}finally{try{e||null==i.return||i.return()}finally{if(a)throw n}}}}]),t}(),q=function(){function t(){Object(l.a)(this,t),this.canvas=null,this.context=null,this.pattern=null,this.tempo=0,this.animate=!1,this.lastRender=Date.now(),this.draw=this.draw.bind(this),this.currentStep=1,this.patternPos={}}return Object(u.a)(t,[{key:"configure",value:function(t,e,a){this.canvas=t,this.context=t.getContext("2d"),this.pattern=e,this.tempo=a}},{key:"setCurrentStep",value:function(t){this.currentStep=t}},{key:"play",value:function(){this.animate=!0,window.requestAnimationFrame(this.draw)}},{key:"pause",value:function(){this.animate=!1}},{key:"draw",value:function(){var t=this.canvas,e=this.context,a=this.pattern,n="20px",r=2,i="#ccc",s="#000",o=4,l="#000",u="#000",h=2,p="#ccc",m="#ccc",f=5,d="#fc0",v="#fc0",y=[200,200],_=y[0],w=y[1],g=80,b=2*Math.PI/a.length,k=-.5*Math.PI;function x(t,a,n){var r=n.radius,i=n.stroke,s=n.fill;e.strokeStyle=i,e.fillStyle=s,e.beginPath(),e.arc(t,a,r,0,2*Math.PI),e.fill(),e.stroke()}function E(t,e){x(t,e,{radius:o,stroke:l,fill:u})}function S(t,e){x(t,e,{radius:h,stroke:p,fill:m})}t.style.padding=n,t.width=_,t.height=w,e.clearRect(0,0,_,w),e.lineWidth=r,e.strokeStyle=i,e.beginPath(),e.arc(_/2,w/2,g,0,2*Math.PI),e.stroke();var T=[];function P(t,e){return[Math.cos(t)*e+_/2,Math.sin(t)*e+w/2]}for(var q=0;q<a.length;q++){var C=P(k+b*q,g),j=Object(c.a)(C,2),O=j[0],A=j[1];"1"===a[q]?(E(O,A),T.push([O,A])):S(O,A),this.patternPos[q]={x:O,y:A}}!function(t){e.strokeStyle=s,e.beginPath(),e.moveTo(t[0][0],t[0][1]);for(var a=1;a<t.length;a++)e.lineTo(t[a][0],t[a][1]);e.closePath(),e.stroke()}(T),function(t,e){x(t,e,{radius:f,stroke:d,fill:v})}(this.patternPos[this.currentStep-1].x,this.patternPos[this.currentStep-1].y),this.animate&&window.requestAnimationFrame(this.draw)}}]),t}(),C=a(24),j=a.n(C),O=a(25),A=a.n(O),M=a(26),N=a.n(M),I=a(27),R=a.n(I),L=a(28),V=a.n(L),B=a(29),W=a.n(B),D=a(30),F=a.n(D),J=a(31),z=a.n(J),G={drum1:j.a,drum2:A.a,drum3:N.a,drum4:R.a,drum5:V.a,drum6:W.a,claves:F.a,cymbal:z.a},H=a(8),X=a(9);function $(t){var e=t.guia,a=t.removeLayer,i=t.preview,s=Object(n.useRef)(),o=e.sequence,c=e.tempo,l=e.layer,u=e.clavis;Object(n.useEffect)((function(){u.configure(s.current,o,c),u.play()}));return r.a.createElement("div",{className:"layer"},r.a.createElement("canvas",{id:p.a.generate(),ref:s,width:640,height:425}),i&&r.a.createElement("p",{className:"Preview"},"Pr\xe9-visualiza\xe7\xe3o"),a&&r.a.createElement("div",{className:"controls"},r.a.createElement("button",{onClick:function(){return l.start(),void u.play()}},r.a.createElement(H.a,{icon:X.a})),r.a.createElement("button",{onClick:function(){return l.stop(),void u.pause()}},r.a.createElement(H.a,{icon:X.b})),r.a.createElement("button",{onClick:function(){return a(e)}},r.a.createElement(H.a,{icon:X.c}))))}var K=a(63),Q=a(66),U=a(64),Y=a(33),Z=a(65);var tt=function(t){var e=t.layers,a=t.pattern,n=t.handlePattern,i=t.setSample,s=(t.beet,t.tempo),o=t.setTempo,c=t.addLayer;return r.a.createElement("div",{className:"header"},r.a.createElement("div",null,r.a.createElement("h1",{className:"header-logo"},"Polymatic ",r.a.createElement("small",null,"v3.2"))),r.a.createElement("div",{className:"header-controls"},r.a.createElement(K.a,{"aria-label":"Basic example"},r.a.createElement(Q.a,{variant:"secondary",onClick:function(){return function(){var t=!0,a=!1,n=void 0;try{for(var r,i=e[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var s=r.value;s.layer.start(),s.clavis.play()}}catch(o){a=!0,n=o}finally{try{t||null==i.return||i.return()}finally{if(a)throw n}}}()}},r.a.createElement(H.a,{icon:X.a})),r.a.createElement(Q.a,{variant:"secondary",onClick:function(){return function(){var t=!0,a=!1,n=void 0;try{for(var r,i=e[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var s=r.value;s.layer.stop(),s.clavis.pause()}}catch(o){a=!0,n=o}finally{try{t||null==i.return||i.return()}finally{if(a)throw n}}}()}},r.a.createElement(H.a,{icon:X.b})))),r.a.createElement("div",{className:"header-form"},r.a.createElement(U.a,null,r.a.createElement(U.a.Prepend,null,r.a.createElement(U.a.Text,{id:"basic-addon3"},"Padr\xe3o")),r.a.createElement(Y.a,{placeholder:"padr\xe3o",value:a,onChange:function(t){return n(t.target.value)}})),r.a.createElement(U.a,null,r.a.createElement(U.a.Prepend,null,r.a.createElement(U.a.Text,{id:"basic-addon3"},"Tempo")),r.a.createElement(Y.a,{placeholder:"tempo",value:s,onChange:function(t){return o(t.target.value)}})),r.a.createElement(Z.a.Control,{as:"select",onChange:function(t){return i(t.target.value)}},Object.keys(G).map((function(t,e){return r.a.createElement("option",{key:e,value:t},t)}))),r.a.createElement(Q.a,{className:"ml-3",onClick:function(){return c()}},"Adicionar")))};a(59),a(60);var et=function(){var t=Object(n.useState)("1000101000101000"),e=Object(c.a)(t,2),a=e[0],i=e[1],s=Object(n.useState)(120),l=Object(c.a)(s,2),u=l[0],h=l[1],m=Object(n.useState)([]),f=Object(c.a)(m,2),d=f[0],v=f[1],y=Object(n.useState)("drum1"),_=Object(c.a)(y,2),w=_[0],g=_[1],b=Object(n.useState)(!0),k=Object(c.a)(b,2),x=k[0],E=k[1];window.AudioContext=window.AudioContext||window.webkitAudioContext;var S=new AudioContext,T=new P({context:S,tempo:u}),C=function(t){T.remove(t.layer),t.clavis.pause(),v(d.filter((function(e){return e.id!==t.id})))};function j(t,e){var a=S.createBufferSource();T.load(T.context,G[w],(function(e){a.buffer=e,a.connect(S.destination),a.start(t)}))}var O={layers:d,pattern:a,handlePattern:function(t){E(!0),i(t)},setSample:g,beet:T,tempo:u,setTempo:h,addLayer:function(){E(!1);var t=T.pattern(a),e=new q,n={layer:T.layer(t,e,j)};n.layer.tempo=u,T.add(n.layer),T.start(),v([].concat(Object(o.a)(d),[{id:p.a.generate(),sequence:a,tempo:u,layer:n.layer,clavis:e}]))}};return r.a.createElement("div",{className:"App"},r.a.createElement(tt,O),r.a.createElement("div",{className:"wrapper"},d.map((function(t){return r.a.createElement($,{key:t.id,guia:t,removeLayer:C})})),x&&a.length>1&&r.a.createElement($,{guia:{sequence:a,clavis:new q,tempo:u},preview:!0})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(et,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[35,1,2]]]);
//# sourceMappingURL=main.41363879.chunk.js.map